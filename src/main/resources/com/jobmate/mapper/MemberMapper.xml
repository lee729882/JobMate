<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jobmate.mapper.MemberMapper">

  <!-- 아이디 중복 여부 -->
  <select id="existsByUsername" parameterType="string" resultType="int">
    SELECT CASE WHEN COUNT(1) > 0 THEN 1 ELSE 0 END
    FROM MEMBER
    WHERE USERNAME = #{username}
  </select>

  <!-- 이메일 중복 여부 -->
  <select id="existsByEmail" parameterType="string" resultType="int">
    SELECT CASE WHEN COUNT(1) > 0 THEN 1 ELSE 0 END
    FROM MEMBER
    WHERE EMAIL = #{email}
  </select>
  
<insert id="insertMember" parameterType="com.jobmate.domain.Member">
    <selectKey keyProperty="id" resultType="long" order="AFTER">
        SELECT ID FROM MEMBER WHERE ROWID = (SELECT MAX(ROWID) FROM MEMBER)
    </selectKey>

    INSERT INTO MEMBER (
        USERNAME, PASSWORD, EMAIL, NAME,
        CAREER_TYPE, EDU_CODE, MIN_SALARY,
        JOB_CODES, WORK_REGION_CODES
    ) VALUES (
        #{username, jdbcType=VARCHAR},
        #{password, jdbcType=VARCHAR},
        #{email, jdbcType=VARCHAR},
        #{name, jdbcType=VARCHAR},
        #{careerType, jdbcType=VARCHAR},
        #{eduCode, jdbcType=VARCHAR},
        #{minSalary, jdbcType=NUMERIC},
        #{jobCodes, jdbcType=VARCHAR},
        #{workRegionCodes, jdbcType=VARCHAR}
    )
</insert>







  <!-- SELECT: mapUnderscoreToCamelCase=true면 resultType으로 충분 -->
  <select id="findByUsername" parameterType="string" resultType="com.jobmate.domain.Member">
    SELECT
      ID, USERNAME, PASSWORD, EMAIL, NAME,
      CAREER_TYPE, EDU_CODE, MIN_SALARY,
      JOB_CODES, WORK_REGION_CODES
      -- , CREATED_AT   <!-- 필요 시 주석 해제하고 Member에 필드 추가 -->
    FROM MEMBER
    WHERE USERNAME = #{username}
  </select>

</mapper>
