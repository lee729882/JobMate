<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jobmate.mapper.MemberPreferenceMapper">

  <!-- 회원 ID로 조회 -->
  <select id="findByMemberId" parameterType="long" resultType="com.jobmate.domain.MemberPreference">
    SELECT ID,
           MEMBER_ID,
           OCC_CODES AS occCodesCsv,
           REGION_CODES AS regionCodesCsv,
           EMPLOYMENT_TYPE,
           CAREER_LEVEL,
           KEYWORD
    FROM MEMBER_PREFERENCE
    WHERE MEMBER_ID = #{memberId}
  </select>

  <!-- MERGE (INSERT or UPDATE) -->
<insert id="upsert" parameterType="com.jobmate.domain.MemberPreference">
  MERGE INTO MEMBER_PREFERENCE target
  USING (SELECT #{memberId, jdbcType=NUMERIC} AS MEMBER_ID FROM DUAL) src
  ON (target.MEMBER_ID = src.MEMBER_ID)
  WHEN MATCHED THEN
    UPDATE SET
      OCC_CODES = #{occCodesCsv, jdbcType=VARCHAR},
      REGION_CODES = #{regionCodesCsv, jdbcType=VARCHAR},
      EMPLOYMENT_TYPE = #{employmentType, jdbcType=VARCHAR},
      CAREER_LEVEL = #{careerLevel, jdbcType=VARCHAR},
      KEYWORD = #{keyword, jdbcType=VARCHAR}
  WHEN NOT MATCHED THEN
    INSERT (MEMBER_ID, OCC_CODES, REGION_CODES, EMPLOYMENT_TYPE, CAREER_LEVEL, KEYWORD)
    VALUES (
      #{memberId, jdbcType=NUMERIC},
      #{occCodesCsv, jdbcType=VARCHAR},
      #{regionCodesCsv, jdbcType=VARCHAR},
      #{employmentType, jdbcType=VARCHAR},
      #{careerLevel, jdbcType=VARCHAR},
      #{keyword, jdbcType=VARCHAR}
    )
</insert>



  <!-- 전체 조회 -->
  <select id="findAll" resultType="com.jobmate.domain.MemberPreference">
    SELECT
      ID,
      MEMBER_ID,
      OCC_CODES,
      REGION_CODES,
      EMPLOYMENT_TYPE,
      CAREER_LEVEL,
      KEYWORD
    FROM MEMBER_PREFERENCE
    ORDER BY MEMBER_ID
  </select>

  <!-- 삭제 -->
  <delete id="deleteByMemberId" parameterType="long">
    DELETE FROM MEMBER_PREFERENCE
    WHERE MEMBER_ID = #{memberId}
  </delete>

</mapper>
